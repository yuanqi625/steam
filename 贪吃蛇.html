<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="./reset.css">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    body{
        background-image: url("./壁纸.jpg") no-repeat;
        background-size: cover
    }
    div {
        border: 1px solid #ee00ee;
        position: relative;
        left: 50%;
        transform: translate(-50%);
        overflow: hidden;
    }

    span {
        position: absolute;
        border-radius: 20%;
    }

    div p {
        width: 20px;
        height: 20px;
        position: absolute;
        background: #f99;
        border-radius: 20%
    }

    #start {
        font-size: 30px;
        position: absolute;
        top: 20%;
        left: 10%;
        user-select: none;
        cursor: pointer;
    }

    #start:hover {
        color: red
    }

    #score {
        font-size: 20px;
        color: red;
        position: absolute;
        top: 28%;
        left: 10%;
        user-select: none;
    }

    ul {
        position: absolute;
        top: 33%;
        left: 10%;
    }

    ul li {
        line-height: 30px;
        cursor: pointer;
    }

    ul li:hover {
        color: red
    }

    #reset {
        font-size: 20px;
        position: absolute;
        top: 60%;
        left: 10%;
        cursor: pointer;
        user-select: none;
    }

    #reset:hover {
        color: red
    }
</style>

<body>
    <p id="start">开始游戏</p>
    <p id="score">分数：0</p>
    <p id="reset">重置</p>
    <ul>
        <li>简单模式</li>
        <li>一般模式</li>
        <li>困难模式</li>
        <li>地狱模式</li>
    </ul>
    <script>
        var score=document.getElementById("score");
        var scorep=0;
        var snakeGame = {
            gameArea: {
                width: 400,
                height: 400,
                backgroundColor: "black",
                area: null,
            },
            position: function () {
                var arr = [];
                for (var i = 0; i < 30; i++) {
                    arr[i] = i * 20;
                }
                return arr;
            },

            foodPostion: {

            },
            snakeBody: {
                width: 20,
                height: 20,
                snakeColor: "blue",
                length: 4,
                snakeArr: [],
                food: null,
            },
            direction: "right",
            gameInit: function () {
                div = document.createElement("div");
                this.gameArea.area = div;
                div.style = "width:" + this.gameArea.width + "px;height:" + this.gameArea.height + "px;background-color:" + this.gameArea.backgroundColor + ";";
                document.body.appendChild(div);

                for (var i = 0; i < snakeGame.snakeBody.length; i++) {
                    span = document.createElement("span");
                    span.style = "width:" + this.snakeBody.width + "px;height:" + this.snakeBody.height + "px;background-color:" + this.snakeBody.snakeColor + ";";
                    span.style.left = i * 20 + "px";
                    span.style.top = 0;
                    div.appendChild(span);
                    this.snakeBody.snakeArr.push(span);

                }
                food = document.createElement("P");
                this.snakeBody.food = food;
                food.style.top = this.position()[Math.floor(Math.random() * 20)] + "px";
                food.style.left = this.position()[Math.floor(Math.random() * 20)] + "px"
                div.appendChild(food)
            },
            snakeMove: function () {
                var foot = this.snakeBody.snakeArr[0];
                // 尾 
                var head = this.snakeBody.snakeArr[this.snakeBody.snakeArr.length - 1];
                // 头
                if (this.direction == "right") {
                    foot.style.left = parseInt(head.style.left) + 20 + "px";
                    foot.style.top = head.style.top;
                    // 改变尾的left值，将其置于头部

                }
                else if (this.direction == "left") {
                    foot.style.left = parseInt(head.style.left) - 20 + "px";
                    foot.style.top = head.style.top;
                }
                else if (this.direction == "down") {
                    foot.style.top = parseInt(getComputedStyle(head).top) + 20 + "px";
                    foot.style.left = head.style.left;
                }
                else if (this.direction == "up") {
                    foot.style.top = parseInt(getComputedStyle(head).top) - 20 + "px";
                    foot.style.left = head.style.left;
                }
                this.snakeBody.snakeArr.shift();
                // 删除数组最后一位
                this.snakeBody.snakeArr.push(foot);
                // 将尾添加到正确的位置以调换顺序  

                head = this.snakeBody.snakeArr[this.snakeBody.snakeArr.length - 1];
                foot = this.snakeBody.snakeArr[0];
                x = parseInt(head.style.left);
                y = parseInt(head.style.top);
                X = parseInt(this.snakeBody.food.style.left);
                Y = parseInt(this.snakeBody.food.style.top);
                fx = foot.style.left;
                fy = foot.style.top;
                if (x == X && y == Y) {
                    var span = document.createElement("span");
                    span.style.left = fx;
                    span.style.top = fy;
                    food.style.left = this.position()[Math.floor(Math.random() * 20)] + "px";
                    food.style.top = this.position()[Math.floor(Math.random() * 20)] + "px";
                    food.style.backgroundColor = getrandomcolor();
                    span.style.width = "20px";
                    span.style.height = "20px";
                    span.style.backgroundColor = this.snakeBody.snakeColor;
                    this.snakeBody.snakeArr.unshift(span);
                    this.gameArea.area.appendChild(span)
                    scorep+=10;
                    score.innerHTML=scorep+" 分"
                }
                if(x==-20 || x==420 || y==-20 || y==420){
                    alert("游戏结束");
                    clearInterval(snakeMove)
                }
                for(var l=0;l<this.snakeBody.snakeArr.length-1;l++){
                    if(x==parseInt(this.snakeBody.snakeArr[l].style.left) && y==parseInt(this.snakeBody.snakeArr[l].style.top)){
                        alert("游戏结束");
                        clearInterval(snakeMove)
                    }

                }
            }
        }
        snakeGame.gameInit()
        window.onkeydown = function () {
            if (event.keyCode == 39 && snakeGame.direction != "left") {
                snakeGame.direction = "right"
            }
            else if (event.keyCode == 37 && snakeGame.direction != "right") {
                snakeGame.direction = "left"
            }
            else if (event.keyCode == 38 && snakeGame.direction != "down") {
                snakeGame.direction = "up"
            }
            else if (event.keyCode == 40 && snakeGame.direction != "up") {
                snakeGame.direction = "down"
            }
        }
        function getrandomcolor() {
            var arr = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
            color = "#";
            for (i = 0; i < 6; i++) {
                var num = Math.floor(Math.random() * 16)
                color += arr[num];
            }
            return color
        }
        var speed = 0;
        var li = document.getElementsByTagName("li");
        var start = document.getElementById("start");
        for (var k = 0; k < li.length; k++) {

            li[k].setAttribute("index", k)
            li[k].onclick = function () {
                gameSpeed = this.getAttribute("index");
            }

        }
        start.onclick = function () {
            switch (gameSpeed) {
                case "0":
                    speed = 400;
                    break;
                case "1":
                    speed = 200;
                    break;
                case "2":
                    speed = 100;
                    break;
                case "3":
                    speed = 16;
                    break;
            }
            snakeMove = setInterval(function () { snakeGame.snakeMove() }, speed)
            

        }

        var reset = document.getElementById("reset");
        reset.onclick = function () {
            clearInterval(snakeMove);
            snakeGame.direction = "right";
            document.body.removeChild(document.body.getElementsByTagName("div")[0]);
            snakeGame.snakeBody.snakeArr = []
            snakeGame.gameInit();
            score.innerHTML="分数：0";
            scorep=0;
        }
    </script>
</body>

</html>